IF OBJECT_ID('tempdb.dbo.#Input', 'U') IS NOT NULL
BEGIN
	DROP TABLE #Input
END

CREATE TABLE #Input (
	TreeLine nvarchar(max)
)

INSERT INTO #Input VALUES
('.#.#....##.......#..........#..'),
('...#...........##...#..#.......'),
('#.####......##.#...#......#.#..'),
('##.....#.#.#..#.#............#.'),
('##.....#....#.........#...##...'),
('###..#.....#....#..............'),
('..........#..#.#..#.#....#.....'),
('##.....#....#.#...#.##.........'),
('#...#......#....##....#..#.#...'),
('.##.##...#....##..#.#.....#...#'),
('.....#.#..........##.#........#'),
('.##..................#..#..##.#'),
('#.#..........##....#.####......'),
('.#......#.#......#.........#...'),
('#....#..##.##..##........#.#...'),
('##..#.##..#...#..####.#..#.....'),
('###....#.###.##...........##..#'),
('.....#.##.....##.#..#####....##'),
('....#.###....#..##....##...#...'),
('..###.#...##.....#.##..#..#.#..'),
('#...#..#..#.........#..#.......'),
('##..#.#.....#.#.#.......#...#.#'),
('...#...##.#........#...#.......'),
('..#..#.#..#...#...#...........#'),
('........#.....#......#...##....'),
('#........##.##.#.#...#...#.....'),
('####.......#.##.###.#....#.....'),
('...#...........#...#......#...#'),
('##...#...#............#.......#'),
('....#...........##.......#.....'),
('###......#.....#....#...#.#...#'),
('.....##..........#.......#.#...'),
('##.##.##...#......#....#.......'),
('##..#.#..#......#...#..#.......'),
('....#....##.##............####.'),
('..#.###..#.##.###..#.##.......#'),
('#.##..#.#.....#..#.....##......'),
('..##..#.....##.#.##........#...'),
('.#..#.#......#..#............#.'),
('.....#..#.#...#....#.##.#......'),
('.#...##.#..#.#...##...##..##...'),
('###............#.#..#..#...#...'),
('..#..##.####.#.....#.....##.###'),
('#....#.##..##....#..#...#.##.#.'),
('.....#.##.........##...##......'),
('.........####.#....#.#......#.#'),
('.........#.#..#...#.#..#.#....#'),
('.#.....#..##.##..##....#.......'),
('..........##......#.##.###....#'),
('.##...###..##.#...#........##..'),
('..............#.#....#.#.###.##'),
('..##.##.......#.#......##...#..'),
('.#.....#..##..#.###...#..#.##.#'),
('#.....#.#..#...#........#...#..'),
('.#......#....#.#.....###...#..#'),
('..##.#....#..##......#.....#...'),
('..#.#.##..#.....#.####..###....'),
('.........#......#..#...........'),
('..#........#.##.#.....##.##..#.'),
('.......#.........#....#...#.#..'),
('.##.....#.#....#.#.......#.....'),
('..........#.##........##...##..'),
('###..###.#.#..#..#####.##.#.##.'),
('..##..##.#.#...#..#.#.#......#.'),
('#..#..#..#..##..#.....#......#.'),
('..#....#.##..#......##.........'),
('..#.##......#...##.#......#....'),
('.......#..#.##.#.....#.........'),
('.......#.#.#.###...##......#...'),
('.....#.#..........#..#...#.....'),
('....##..........#..........##..'),
('..#......#.....#.##.#..#...#.#.'),
('....#.....#..#...#..#.#.##..###'),
('.####....#........#...#........'),
('...##.#.##.#..#...##...#.##....'),
('....#...#...#.#.#.#...#..#.....'),
('.....#...#.#.....#.#........##.'),
('..#.#.......###.#.....##.......'),
('......#.........##....#....#..#'),
('.............##.....##.........'),
('.........##...##.......#.....#.'),
('##.........#..........#.###..##'),
('...#.....#......#....#..##.....'),
('##..#...#...##.#.....#.#......#'),
('..#...##.#.......#.#......#.##.'),
('......#.......#.#...........#..'),
('..........#.....##............#'),
('#........#...#..#.......###.##.'),
('.##...........#.#........#.#.#.'),
('...#..##...#.#....#####.#......'),
('.....##...###...#..#.##...####.'),
('...#....#.....#..#.......#.....'),
('#....#....#...#..#..#.######..#'),
('#.###...........#......#...#..#'),
('.#.#.#.#..#....#....#...##.#...'),
('.#..#.........#.#....###...#...'),
('......#..##.##..........#....##'),
('.....#......##....##.....#...#.'),
('.#...#.#.#....##....#..#....#.#'),
('..................#..###.#..##.'),
('..#.........#......#....#..###.'),
('#.#.....#..#..#....###..###....'),
('..##..##.#..##........##...##..'),
('##..#........##..###..#.....#.#'),
('..#..###..#......#....#...#...#'),
('#..#.#..............##.#..#.#..'),
('.....####....#...####.....#.#..'),
('.....#....##.#......###........'),
('##.##...#.#.#.#.......#....##..'),
('.#......#...#.#....#..##.#.##.#'),
('#.#.##.#.#......#..##........##'),
('...##.....#.....#...#..###...#.'),
('........###.....#.....#...##..#'),
('.....#.##.##......#.#....#...#.'),
('.#....##.......#..#.####.......'),
('.#..#....#..........#......#.#.'),
('.#.##.##.....###.#.#...........'),
('.........#......#..##..........'),
('....#...##.#.#.#..#.#.........#'),
('..#.....#.##...#..#..#.###....#'),
('...#.##......#.....##....#.....'),
('###............#.#....#...#....'),
('.......#.....#..#.#.#....#..#.#'),
('...#......#.#..##..#....#...#.#'),
('............##........##..##...'),
('..#..#.##..#......###..#.......'),
('........#.........#............'),
('..#...#.#########.#...##..###..'),
('#....#......#.......#.#.....#..'),
('#.#..#....###.###....#...#.#...'),
('#...###.#.#.......#.##......#..'),
('.................#...#.#.#.....'),
('##....#...#........#....#.#..#.'),
('......#.....#...#..........#.#.'),
('##..........#...#..........#.##'),
('..#.#.##.#....#.#......#...##..'),
('.....#.......#..#.....#........'),
('#.##.#..##..#.......##.........'),
('....#......#..#..#.#...#.......'),
('...#....#................###...'),
('.##.....#.#....#.#..........##.'),
('...#..#....#.##.##......#......'),
('..#.#....#.......#.#..##.......'),
('....#.....#..........##.#.#####'),
('#.....................##..#..#.'),
('.###..#.##.......##.#...#..#...'),
('...###.......#..#...#......#..#'),
('#..#...#.#..#.#..#..#.##.......'),
('#...##.......#..#..#.##..###...'),
('......#....#.#.#........#.##..#'),
('..##..#....#....#..#.#..#......'),
('..##.#...#.#######..#...#.....#'),
('..#....#..#.........#..##......'),
('...#....#.#......#..#..#.#.....'),
('#..#....#........#.#..##....###'),
('#....#..##......##.##.....#.###'),
('...#.#..........#..#.#.#.#.##..'),
('......##..#.#..#.#....#....#...'),
('##....#....#..#..#.##......#...'),
('....#.#..##.#.#...###....##.#..'),
('...#.......##..#.......#...#...'),
('......##.......#..##.....#...#.'),
('...#.#...#...........#...#.....'),
('.#....#...#......##.##..###..#.'),
('.#..........#...#...#...##.##..'),
('.....###..#.....#..##....#.####'),
('..#.###..#..##..##.....#.#.....'),
('.............#.###...##.#.....#'),
('....###.......###.#.....#..#.#.'),
('........##.#.........#.....###.'),
('.....###.#..#.....#...#..#.....'),
('.#....#..##.#..#.#....#.......#'),
('........#......#.#..#.#..#...##'),
('...#.##.##......#..............'),
('.#.....##.#.....#..#......##...'),
('#..#..#.....#.....#.....###....'),
('.##...........#..#.##.....#....'),
('..#.#......#.#...#.##.#..#...##'),
('...#..........#.....#..........'),
('#.#.#.#.#...#....#...#.....##..'),
('#......##...#...#..........#.#.'),
('....##........#.#..............'),
('#..#.#.#..#........##......#.##'),
('........####...##.#.....#......'),
('....#........#.#..#..##..#.#...'),
('.#.....#..###...#..#.....#..#..'),
('#......###.#..#....#..#.#......'),
('....#.....##.##..#...#.#..##.#.'),
('..##..#...#.#......#....#...#.#'),
('#..##...##..#...###...#..#.....'),
('.......#.....#...........##....'),
('#..##....#........#....##..#.#.'),
('.#........#..##...###.#..#.....'),
('.#.#....#..##...#...##.#..###..'),
('#.........#.......#.....#.#....'),
('#..#.....#.#.###.#..#......#...'),
('....#..#.#....#..##..###....###'),
('###.##.#.#..#...........#.#.#..'),
('..##.#.......#......#..##....#.'),
('.....#.#.#.......##.......#...#'),
('...........#.##....##.##....#.#'),
('...#.......#..#.##..#......#..#'),
('#.#.#...#......##.#...........#'),
('##........#...........###.#..#.'),
('..........#.#.#....#.#..##.#.#.'),
('...#.#.#....#..........#..#....'),
('#.#....###.#.#..#.......###...#'),
('.#....#......#.#.#..#..#.......'),
('......##.............#....#.#.#'),
('.#..........#.........#.##.....'),
('##....#....##....#..#.......#..'),
('#.##.##.#..#..#.....#..#.##.#..'),
('.#..#.......##..#.....##.##....'),
('.......#..........#.#.##..#.##.'),
('....#.....#.#...##....##.......'),
('.......#.........#...##....##.#'),
('#.....#......#..........#...#..'),
('...#.#.......#.#..#....###..#..'),
('.....#.#.#.........#...........'),
('.#..###.#.#........#.#.........'),
('.........#..#......##...##....#'),
('...###..#.....##.....#.###....#'),
('.##...#...#........###.#..#....'),
('.##........#..#.###.######.##.#'),
('##.#...#.#....#..##.#....##....'),
('.......##.....##.#..###.#......'),
('..##...##........#.......#....#'),
('#..##...#.####...###......#...#'),
('.##.....#.##.#.#.....###.#..##.'),
('..###....#.#.###.#....#........'),
('....#..###..#...#....#..#..#.#.'),
('#.#.##....##...##.......#......'),
('.........#...#....#..#.........'),
('.............#...#..##.#.......'),
('...#.##.......#...#.#..##.##...'),
('.####.#.##..#.#......#.##...#.#'),
('.#..#.#.....#.................#'),
('..#.##..###....#...#......####.'),
('..##..##...........#....#...#..'),
('....#...#...#...#.......#....#.'),
('#.#...###...#...#.#...#....##.#'),
('......#...#.#.......#.....#...#'),
('....##...#.#.#....#....#.#....#'),
('.....#.....#...##..#...#....##.'),
('#.....#....#......##.##....#...'),
('...#.#....#...#....#.#....##..#'),
('...#.#..#...##....###..#.......'),
('...##......###...###.#...#..#..'),
('##.......#.......###.......#..#'),
('..##.##..###.#............#...#'),
('#.....##..#..##....##..#.......'),
('......#.#...#......#.....#.....'),
('#...........#....#..##.##.#....'),
('.......#..#......#...#....#...#'),
('.#...##...........#......#...#.'),
('#........#....##...###.#....#..'),
('.....#.......##.........#.##...'),
('.#.###..#....#..##.#..#.#..#...'),
('#.......#.##.#.#....#.#..#....#'),
('###.....#.#.......#..#......#.#'),
('#..#.#.......#.#..##..##.#.#...'),
('#..#.#.#.###........#.....#...#'),
('#.#.#..#..##.....#...........#.'),
('..#.#..#.....#...#...#...##....'),
('...#.##......#...##.#...#.#.#.#'),
('#..#.#.#.#.......####..........'),
('..#......#.#......##.###.....##'),
('..#...##..#.........##....#.##.'),
('##.##.##.#.#.....#..........##.'),
('.#.....###.#..#....#..#.###...#'),
('#...##.......###....#.#..#.....'),
('..#....##.........##.........##'),
('......#....#.##.......#........'),
('..#.#.#..#...#...#...##.#...#..'),
('......#..##.#.#.#...##...#.#.##'),
('#..#...##.#.....#...#.##.......'),
('..#..#.........##.#...#.##...##'),
('##.##.#....#.......#.##..#.....'),
('.....##...##.##...##.........##'),
('#......#...#.......#...#...#...'),
('...##...........#...#..#.......'),
('.#.##.#..#........#....#.......'),
('#.#...#..#......##...#.#.##....'),
('##........####..#.#...#.#.##.##'),
('#..#.#.##......##.#.#..#.......'),
('.....#.........#..#.####....#..'),
('......##..#....#...#.#....#....'),
('#...##........#.........#.....#'),
('.#.#...#.#.#..#............##.#'),
('.#..#....#....#.....#...#.....#'),
('..###...#..#.....#.##.###...#.#'),
('.#.###..#..#...#.#...#.#......#'),
('#...#####......###........##...'),
('.....#.....#..#.#....#..##.....'),
('....##...#.#.##.#####...#....#.'),
('.#.#.........##.#.......#..##..'),
('.#...#.#...#...#....#.#...##.#.'),
('.##...#..#.#..#......#.#.#..##.'),
('..#.....#..#.....##.....#......'),
('..#........#..##...#.......###.'),
('.#....#.......#....#....#..#...'),
('....#......#.#.#.........#.....'),
('..##...#.#.#...#.#........#....'),
('.#.....####...##.#..#...##.....'),
('...#.....#...#...#....#....#...'),
('.........#..#.#.....#..#.#..#..'),
('.........##...........#.......#'),
('......#..#.....##...#.##.#.....'),
('.#......##........##...#.#.##..'),
('.....#.#..##...........#..#..#.'),
('...#.......#...#.#..#.##..#.##.'),
('...#.......#.....#.#...#.##.#..'),
('#.....#.............##.#..####.'),
('.#...#......#...##.#....#.#....'),
('.##..##.##....#.#.....#.......#'),
('...#...#....#....##.#..#....##.'),
('..............##....#.......#.#'),
('.#.#.#...##..#..#...###.#..#...'),
('.#.#...#.#..#.#..#...######..#.'),
('........#......#.#..#.#....#...'),
('..###.....###.#.##....#...##...'),
('.##.#.....#.......##.......#...'),
('..#..##...#..........#.#....#.#')

IF OBJECT_ID('tempdb.dbo.#Slopes', 'U') IS NOT NULL
BEGIN
	DROP TABLE #Slopes
END

CREATE TABLE #Slopes (
	XSlope int,
	YSlope int
)

INSERT INTO #Slopes
VALUES 
(1,1),
(3,1),
(5,1),
(7,1),
(1,2)

DECLARE slope_cursor CURSOR FOR (
	SELECT XSlope, YSlope FROM #Slopes
)

DECLARE 
	@XSlope int,
	@YSlope int,
	@CumulativeTreeProduct bigint = 1

OPEN slope_cursor

FETCH NEXT FROM slope_cursor
INTO @XSlope, @YSlope

WHILE @@FETCH_STATUS = 0
BEGIN
	DECLARE 
		@XValue int = 0,
		@YValue int = 0,
		@CurrentTreeLine nvarchar(max),
		@TreeCount int = 0

	DECLARE treeline_cursor CURSOR FOR (
		SELECT TreeLine FROM #Input
	)

	OPEN treeline_cursor

	FETCH NEXT FROM treeline_cursor
	INTO @CurrentTreeLine

	DECLARE @TreeLength int = LEN(@CurrentTreeLine);

	FETCH NEXT FROM treeline_cursor
	INTO @CurrentTreeLine

	WHILE @@FETCH_STATUS = 0
	BEGIN
		SET @YValue = @YValue + 1

		IF (@YValue % @YSlope = 0)
		BEGIN
			SET @XValue = (@XValue + @XSlope) % @TreeLength

			IF (SUBSTRING(@CurrentTreeLine, @XValue + 1, 1) = '#')
			BEGIN
				SET @TreeCount = @TreeCount + 1
			END
		END

		FETCH NEXT FROM treeline_cursor
		INTO @CurrentTreeLine
	END

	CLOSE treeline_cursor
	DEALLOCATE treeline_cursor

	SET @CumulativeTreeProduct = @CumulativeTreeProduct * @TreeCount

	FETCH NEXT FROM slope_cursor
	INTO @XSlope, @YSlope
END

CLOSE slope_cursor
DEALLOCATE slope_cursor

SELECT @CumulativeTreeProduct